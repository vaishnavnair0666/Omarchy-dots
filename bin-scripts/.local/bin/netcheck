#!/usr/bin/env bash
# netcheck - quick internet + DNS sanity check

set -e

echo "== Interface check =="
ip -br addr | grep -E 'UP|UNKNOWN' || echo "No interfaces up!"

echo -e "\n== Default route =="
ip route | grep default || echo "No default route!"

echo -e "\n== Ping raw IP (Google DNS) =="
if ping -c 2 -W 2 8.8.8.8 >/dev/null; then
  echo "OK: Can reach internet via IP"
else
  echo "FAIL: No internet connectivity"
fi

echo -e "\n== DNS test (google.com) =="
if ping -c 2 -W 2 google.com >/dev/null; then
  echo "OK: DNS resolution works"
else
  echo "FAIL: DNS broken"
  echo "Current resolv.conf:"
  cat /etc/resolv.conf
fi

echo -e "\n== Active DNS (systemd-resolved) =="
if command -v resolvectl >/dev/null; then
  resolvectl status | awk '/Current DNS Server/ || /DNS Servers/'
fi

